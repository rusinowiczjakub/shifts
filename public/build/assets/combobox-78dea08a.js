import{r as p,f as $e,R as L}from"./app-9abdc924.js";import{s as Oe,l as j,o as x,O as me,U as H,u as J,a as ze,d as te,x as Pe,C as X,y as W,b as De}from"./open-closed-cc97ada5.js";import{p as ce}from"./use-disposables-a582fc9d.js";import{I as G,o as k,r as Fe}from"./keyboard-162aa7ee.js";import{y as Ae,n as ke,b as _e,I as je}from"./use-owner-8efe843c.js";import{T as Le}from"./use-resolve-button-type-bb0c62cc.js";import{F as Ne,u as Ve,c as T,f as be}from"./calculate-active-index-ebb0d854.js";import{m as ge,t as he}from"./active-element-history-67c2f0be.js";import{f as Be,s as Ke}from"./hidden-fa26c168.js";import{o as xe}from"./disposables-253897a2.js";/**
 * react-virtual
 *
 * Copyright (c) TanStack
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ne(){return ne=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])}return n},ne.apply(this,arguments)}/**
 * virtual-core
 *
 * Copyright (c) TanStack
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function oe(){return oe=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])}return n},oe.apply(this,arguments)}/**
 * virtual-core
 *
 * Copyright (c) TanStack
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function q(n,i,e){var t,o=(t=e.initialDeps)!=null?t:[],r;return function(){var l;e.key&&e.debug!=null&&e.debug()&&(l=Date.now());var u=n(),c=u.length!==o.length||u.some(function(v,g){return o[g]!==v});if(!c)return r;o=u;var s;if(e.key&&e.debug!=null&&e.debug()&&(s=Date.now()),r=i.apply(void 0,u),e.key&&e.debug!=null&&e.debug()){var f=Math.round((Date.now()-l)*100)/100,m=Math.round((Date.now()-s)*100)/100,R=m/16,a=function(g,O){for(g=String(g);g.length<O;)g=" "+g;return g};console.info("%câ± "+a(m,5)+" /"+a(f,5)+" ms",`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(`+Math.max(0,Math.min(120-120*R,120))+"deg 100% 31%);",e==null?void 0:e.key)}return e==null||e.onChange==null||e.onChange(r),r}}function ue(n,i){if(n===void 0)throw new Error("Unexpected undefined"+(i?": "+i:""));return n}var Ue=function(i,e){return Math.abs(i-e)<1};/**
 * virtual-core
 *
 * Copyright (c) TanStack
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var qe=function(i){return i},Je=function(i){for(var e=Math.max(i.startIndex-i.overscan,0),t=Math.min(i.endIndex+i.overscan,i.count-1),o=[],r=e;r<=t;r++)o.push(r);return o},He=function(i,e){var t=i.scrollElement;if(t){var o=function(u){var c=u.width,s=u.height;e({width:Math.round(c),height:Math.round(s)})};o(t.getBoundingClientRect());var r=new ResizeObserver(function(l){var u=l[0];if(u!=null&&u.borderBoxSize){var c=u.borderBoxSize[0];if(c){o({width:c.inlineSize,height:c.blockSize});return}}o(t.getBoundingClientRect())});return r.observe(t,{box:"border-box"}),function(){r.unobserve(t)}}},Xe=function(i,e){var t=i.scrollElement;if(t){var o=function(){e(t[i.options.horizontal?"scrollLeft":"scrollTop"])};return o(),t.addEventListener("scroll",o,{passive:!0}),function(){t.removeEventListener("scroll",o)}}},Ye=function(i,e,t){if(e!=null&&e.borderBoxSize){var o=e.borderBoxSize[0];if(o){var r=Math.round(o[t.options.horizontal?"inlineSize":"blockSize"]);return r}}return Math.round(i.getBoundingClientRect()[t.options.horizontal?"width":"height"])},We=function(i,e,t){var o,r,l=e.adjustments,u=l===void 0?0:l,c=e.behavior,s=i+u;(o=t.scrollElement)==null||o.scrollTo==null||o.scrollTo((r={},r[t.options.horizontal?"left":"top"]=s,r.behavior=c,r))},Ge=function(i){var e=this;this.unsubs=[],this.scrollElement=null,this.isScrolling=!1,this.isScrollingTimeoutId=null,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollDirection=null,this.scrollAdjustments=0,this.measureElementCache=new Map,this.observer=function(){var t=null,o=function(){return t||(typeof ResizeObserver<"u"?t=new ResizeObserver(function(l){l.forEach(function(u){e._measureElement(u.target,u)})}):null)};return{disconnect:function(){var l;return(l=o())==null?void 0:l.disconnect()},observe:function(l){var u;return(u=o())==null?void 0:u.observe(l,{box:"border-box"})},unobserve:function(l){var u;return(u=o())==null?void 0:u.unobserve(l)}}}(),this.range=null,this.setOptions=function(t){Object.entries(t).forEach(function(o){var r=o[0],l=o[1];typeof l>"u"&&delete t[r]}),e.options=oe({debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:qe,rangeExtractor:Je,onChange:function(){},measureElement:Ye,initialRect:{width:0,height:0},scrollMargin:0,scrollingDelay:150,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1},t)},this.notify=function(t){e.options.onChange==null||e.options.onChange(e,t)},this.maybeNotify=q(function(){return e.calculateRange(),[e.isScrolling,e.range?e.range.startIndex:null,e.range?e.range.endIndex:null]},function(t){e.notify(t)},{key:!1,debug:function(){return e.options.debug},initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=function(){e.unsubs.filter(Boolean).forEach(function(t){return t()}),e.unsubs=[],e.scrollElement=null},this._didMount=function(){return e.measureElementCache.forEach(e.observer.observe),function(){e.observer.disconnect(),e.cleanup()}},this._willUpdate=function(){var t=e.options.getScrollElement();e.scrollElement!==t&&(e.cleanup(),e.scrollElement=t,e._scrollToOffset(e.scrollOffset,{adjustments:void 0,behavior:void 0}),e.unsubs.push(e.options.observeElementRect(e,function(o){e.scrollRect=o,e.maybeNotify()})),e.unsubs.push(e.options.observeElementOffset(e,function(o){e.scrollAdjustments=0,e.scrollOffset!==o&&(e.isScrollingTimeoutId!==null&&(clearTimeout(e.isScrollingTimeoutId),e.isScrollingTimeoutId=null),e.isScrolling=!0,e.scrollDirection=e.scrollOffset<o?"forward":"backward",e.scrollOffset=o,e.maybeNotify(),e.isScrollingTimeoutId=setTimeout(function(){e.isScrollingTimeoutId=null,e.isScrolling=!1,e.scrollDirection=null,e.maybeNotify()},e.options.scrollingDelay))})))},this.getSize=function(){return e.scrollRect[e.options.horizontal?"width":"height"]},this.memoOptions=q(function(){return[e.options.count,e.options.paddingStart,e.options.scrollMargin,e.options.getItemKey]},function(t,o,r,l){return e.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:o,scrollMargin:r,getItemKey:l}},{key:!1}),this.getFurthestMeasurement=function(t,o){for(var r=new Map,l=new Map,u=o-1;u>=0;u--){var c=t[u];if(!r.has(c.lane)){var s=l.get(c.lane);if(s==null||c.end>s.end?l.set(c.lane,c):c.end<s.end&&r.set(c.lane,!0),r.size===e.options.lanes)break}}return l.size===e.options.lanes?Array.from(l.values()).sort(function(f,m){return f.end-m.end})[0]:void 0},this.getMeasurements=q(function(){return[e.memoOptions(),e.itemSizeCache]},function(t,o){var r=t.count,l=t.paddingStart,u=t.scrollMargin,c=t.getItemKey,s=e.pendingMeasuredCacheIndexes.length>0?Math.min.apply(Math,e.pendingMeasuredCacheIndexes):0;e.pendingMeasuredCacheIndexes=[];for(var f=e.measurementsCache.slice(0,s),m=s;m<r;m++){var R=c(m),a=e.options.lanes===1?f[m-1]:e.getFurthestMeasurement(f,m),v=a?a.end:l+u,g=o.get(R),O=typeof g=="number"?g:e.options.estimateSize(m),h=v+O,M=a?a.lane:m%e.options.lanes;f[m]={index:m,start:v,size:O,end:h,key:R,lane:M}}return e.measurementsCache=f,f},{key:!1,debug:function(){return e.options.debug}}),this.calculateRange=q(function(){return[e.getMeasurements(),e.getSize(),e.scrollOffset]},function(t,o,r){return e.range=t.length>0&&o>0?Qe({measurements:t,outerSize:o,scrollOffset:r}):null},{key:!1,debug:function(){return e.options.debug}}),this.getIndexes=q(function(){return[e.options.rangeExtractor,e.calculateRange(),e.options.overscan,e.options.count]},function(t,o,r,l){return o===null?[]:t(oe({},o,{overscan:r,count:l}))},{key:!1,debug:function(){return e.options.debug}}),this.indexFromElement=function(t){var o=e.options.indexAttribute,r=t.getAttribute(o);return r?parseInt(r,10):(console.warn("Missing attribute name '"+o+"={index}' on measured element."),-1)},this._measureElement=function(t,o){var r=e.measurementsCache[e.indexFromElement(t)];if(!r||!t.isConnected){e.measureElementCache.forEach(function(c,s){c===t&&(e.observer.unobserve(t),e.measureElementCache.delete(s))});return}var l=e.measureElementCache.get(r.key);l!==t&&(l&&e.observer.unobserve(l),e.observer.observe(t),e.measureElementCache.set(r.key,t));var u=e.options.measureElement(t,o,e);e.resizeItem(r,u)},this.resizeItem=function(t,o){var r,l=(r=e.itemSizeCache.get(t.key))!=null?r:t.size,u=o-l;u!==0&&(t.start<e.scrollOffset&&e._scrollToOffset(e.scrollOffset,{adjustments:e.scrollAdjustments+=u,behavior:void 0}),e.pendingMeasuredCacheIndexes.push(t.index),e.itemSizeCache=new Map(e.itemSizeCache.set(t.key,o)),e.notify(!1))},this.measureElement=function(t){t&&e._measureElement(t,void 0)},this.getVirtualItems=q(function(){return[e.getIndexes(),e.getMeasurements()]},function(t,o){for(var r=[],l=0,u=t.length;l<u;l++){var c=t[l],s=o[c];r.push(s)}return r},{key:!1,debug:function(){return e.options.debug}}),this.getVirtualItemForOffset=function(t){var o=e.getMeasurements();return ue(o[Ie(0,o.length-1,function(r){return ue(o[r]).start},t)])},this.getOffsetForAlignment=function(t,o){var r=e.getSize();o==="auto"&&(t<=e.scrollOffset?o="start":t>=e.scrollOffset+r?o="end":o="start"),o==="start"?t=t:o==="end"?t=t-r:o==="center"&&(t=t-r/2);var l=e.options.horizontal?"scrollWidth":"scrollHeight",u=e.scrollElement?"document"in e.scrollElement?e.scrollElement.document.documentElement[l]:e.scrollElement[l]:0,c=u-e.getSize();return Math.max(Math.min(c,t),0)},this.getOffsetForIndex=function(t,o){o===void 0&&(o="auto"),t=Math.max(0,Math.min(t,e.options.count-1));var r=ue(e.getMeasurements()[t]);if(o==="auto")if(r.end>=e.scrollOffset+e.getSize()-e.options.scrollPaddingEnd)o="end";else if(r.start<=e.scrollOffset+e.options.scrollPaddingStart)o="start";else return[e.scrollOffset,o];var l=o==="end"?r.end+e.options.scrollPaddingEnd:r.start-e.options.scrollPaddingStart;return[e.getOffsetForAlignment(l,o),o]},this.isDynamicMode=function(){return e.measureElementCache.size>0},this.cancelScrollToIndex=function(){e.scrollToIndexTimeoutId!==null&&(clearTimeout(e.scrollToIndexTimeoutId),e.scrollToIndexTimeoutId=null)},this.scrollToOffset=function(t,o){var r=o===void 0?{}:o,l=r.align,u=l===void 0?"start":l,c=r.behavior;e.cancelScrollToIndex(),c==="smooth"&&e.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e._scrollToOffset(e.getOffsetForAlignment(t,u),{adjustments:void 0,behavior:c})},this.scrollToIndex=function(t,o){var r=o===void 0?{}:o,l=r.align,u=l===void 0?"auto":l,c=r.behavior;t=Math.max(0,Math.min(t,e.options.count-1)),e.cancelScrollToIndex(),c==="smooth"&&e.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");var s=e.getOffsetForIndex(t,u),f=s[0],m=s[1];e._scrollToOffset(f,{adjustments:void 0,behavior:c}),c!=="smooth"&&e.isDynamicMode()&&(e.scrollToIndexTimeoutId=setTimeout(function(){e.scrollToIndexTimeoutId=null;var R=e.measureElementCache.has(e.options.getItemKey(t));if(R){var a=e.getOffsetForIndex(t,m),v=a[0];Ue(v,e.scrollOffset)||e.scrollToIndex(t,{align:m,behavior:c})}else e.scrollToIndex(t,{align:m,behavior:c})}))},this.scrollBy=function(t,o){var r=o===void 0?{}:o,l=r.behavior;e.cancelScrollToIndex(),l==="smooth"&&e.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e._scrollToOffset(e.scrollOffset+t,{adjustments:void 0,behavior:l})},this.getTotalSize=function(){var t;return(((t=e.getMeasurements()[e.options.count-1])==null?void 0:t.end)||e.options.paddingStart)-e.options.scrollMargin+e.options.paddingEnd},this._scrollToOffset=function(t,o){var r=o.adjustments,l=o.behavior;e.options.scrollToFn(t,{behavior:l,adjustments:r},e)},this.measure=function(){e.itemSizeCache=new Map,e.notify(!1)},this.setOptions(i),this.scrollRect=this.options.initialRect,this.scrollOffset=this.options.initialOffset,this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(function(t){e.itemSizeCache.set(t.key,t.size)}),this.maybeNotify()},Ie=function(i,e,t,o){for(;i<=e;){var r=(i+e)/2|0,l=t(r);if(l<o)i=r+1;else if(l>o)e=r-1;else return r}return i>0?i-1:0};function Qe(n){for(var i=n.measurements,e=n.outerSize,t=n.scrollOffset,o=i.length-1,r=function(s){return i[s].start},l=Ie(0,o,r,t),u=l;u<o&&i[u].end<t+e;)u++;return{startIndex:l,endIndex:u}}/**
 * react-virtual
 *
 * Copyright (c) TanStack
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Ze=typeof document<"u"?p.useLayoutEffect:p.useEffect;function et(n){var i=p.useReducer(function(){return{}},{})[1],e=ne({},n,{onChange:function(l,u){u?$e.flushSync(i):i(),n.onChange==null||n.onChange(l,u)}}),t=p.useState(function(){return new Ge(e)}),o=t[0];return o.setOptions(e),p.useEffect(function(){return o._didMount()},[]),Ze(function(){return o._willUpdate()}),o}function tt(n){return et(ne({observeElementRect:He,observeElementOffset:Xe,scrollToFn:We},n))}function de(n,i){let[e,t]=p.useState(n),o=Oe(n);return j(()=>t(o.current),[o,t,...i]),e}function nt(n,i,e){let[t,o]=p.useState(e),r=n!==void 0,l=p.useRef(r),u=p.useRef(!1),c=p.useRef(!1);return r&&!l.current&&!u.current?(u.current=!0,l.current=r,console.error("A component is changing from uncontrolled to controlled. This may be caused by the value changing from undefined to a defined value, which should not happen.")):!r&&l.current&&!c.current&&(c.current=!0,l.current=r,console.error("A component is changing from controlled to uncontrolled. This may be caused by the value changing from a defined value to undefined, which should not happen.")),[r?n:t,x(s=>(r||o(s),i==null?void 0:i(s)))]}function Se(n={},i=null,e=[]){for(let[t,o]of Object.entries(n))Ce(e,Re(i,t),o);return e}function Re(n,i){return n?n+"["+i+"]":i}function Ce(n,i,e){if(Array.isArray(e))for(let[t,o]of e.entries())Ce(n,Re(i,t.toString()),o);else e instanceof Date?n.push([i,e.toISOString()]):typeof e=="boolean"?n.push([i,e?"1":"0"]):typeof e=="string"?n.push([i,e]):typeof e=="number"?n.push([i,`${e}`]):e==null?n.push([i,""]):Se(e,i,n)}var ot=(n=>(n[n.Open=0]="Open",n[n.Closed=1]="Closed",n))(ot||{}),rt=(n=>(n[n.Single=0]="Single",n[n.Multi=1]="Multi",n))(rt||{}),it=(n=>(n[n.Pointer=0]="Pointer",n[n.Focus=1]="Focus",n[n.Other=2]="Other",n))(it||{}),lt=(n=>(n[n.OpenCombobox=0]="OpenCombobox",n[n.CloseCombobox=1]="CloseCombobox",n[n.GoToOption=2]="GoToOption",n[n.RegisterOption=3]="RegisterOption",n[n.UnregisterOption=4]="UnregisterOption",n[n.RegisterLabel=5]="RegisterLabel",n[n.SetActivationTrigger=6]="SetActivationTrigger",n[n.UpdateVirtualOptions=7]="UpdateVirtualOptions",n))(lt||{});function se(n,i=e=>e){let e=n.activeOptionIndex!==null?n.options[n.activeOptionIndex]:null,t=i(n.options.slice()),o=t.length>0&&t[0].dataRef.current.order!==null?t.sort((l,u)=>l.dataRef.current.order-u.dataRef.current.order):je(t,l=>l.dataRef.current.domRef.current),r=e?o.indexOf(e):null;return r===-1&&(r=null),{options:o,activeOptionIndex:r}}let at={1(n){var i;return(i=n.dataRef.current)!=null&&i.disabled||n.comboboxState===1?n:{...n,activeOptionIndex:null,comboboxState:1}},0(n){var i,e;if((i=n.dataRef.current)!=null&&i.disabled||n.comboboxState===0)return n;if((e=n.dataRef.current)!=null&&e.value){let t=n.dataRef.current.calculateIndex(n.dataRef.current.value);if(t!==-1)return{...n,activeOptionIndex:t,comboboxState:0}}return{...n,comboboxState:0}},2(n,i){var e,t,o,r,l;if((e=n.dataRef.current)!=null&&e.disabled||(t=n.dataRef.current)!=null&&t.optionsRef.current&&!((o=n.dataRef.current)!=null&&o.optionsPropsRef.current.static)&&n.comboboxState===1)return n;if(n.virtual){let f=i.focus===T.Specific?i.idx:be(i,{resolveItems:()=>n.virtual.options,resolveActiveIndex:()=>{var R,a;return(a=(R=n.activeOptionIndex)!=null?R:n.virtual.options.findIndex(v=>!n.virtual.disabled(v)))!=null?a:null},resolveDisabled:n.virtual.disabled,resolveId(){throw new Error("Function not implemented.")}}),m=(r=i.trigger)!=null?r:2;return n.activeOptionIndex===f&&n.activationTrigger===m?n:{...n,activeOptionIndex:f,activationTrigger:m}}let u=se(n);if(u.activeOptionIndex===null){let f=u.options.findIndex(m=>!m.dataRef.current.disabled);f!==-1&&(u.activeOptionIndex=f)}let c=i.focus===T.Specific?i.idx:be(i,{resolveItems:()=>u.options,resolveActiveIndex:()=>u.activeOptionIndex,resolveId:f=>f.id,resolveDisabled:f=>f.dataRef.current.disabled}),s=(l=i.trigger)!=null?l:2;return n.activeOptionIndex===c&&n.activationTrigger===s?n:{...n,...u,activeOptionIndex:c,activationTrigger:s}},3:(n,i)=>{var e,t,o;if((e=n.dataRef.current)!=null&&e.virtual)return{...n,options:[...n.options,i.payload]};let r=i.payload,l=se(n,c=>(c.push(r),c));n.activeOptionIndex===null&&(t=n.dataRef.current)!=null&&t.isSelected(i.payload.dataRef.current.value)&&(l.activeOptionIndex=l.options.indexOf(r));let u={...n,...l,activationTrigger:2};return(o=n.dataRef.current)!=null&&o.__demoMode&&n.dataRef.current.value===void 0&&(u.activeOptionIndex=0),u},4:(n,i)=>{var e;if((e=n.dataRef.current)!=null&&e.virtual)return{...n,options:n.options.filter(o=>o.id!==i.id)};let t=se(n,o=>{let r=o.findIndex(l=>l.id===i.id);return r!==-1&&o.splice(r,1),o});return{...n,...t,activationTrigger:2}},5:(n,i)=>n.labelId===i.id?n:{...n,labelId:i.id},6:(n,i)=>n.activationTrigger===i.trigger?n:{...n,activationTrigger:i.trigger},7:(n,i)=>{var e;if(((e=n.virtual)==null?void 0:e.options)===i.options)return n;let t=n.activeOptionIndex;if(n.activeOptionIndex!==null){let o=i.options.indexOf(n.virtual.options[n.activeOptionIndex]);o!==-1?t=o:t=null}return{...n,activeOptionIndex:t,virtual:Object.assign({},n.virtual,{options:i.options})}}},fe=p.createContext(null);fe.displayName="ComboboxActionsContext";function Q(n){let i=p.useContext(fe);if(i===null){let e=new Error(`<${n} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,Q),e}return i}let ye=p.createContext(null);function ut(n){var i;let e=V("VirtualProvider"),[t,o]=p.useMemo(()=>{let c=e.optionsRef.current;if(!c)return[0,0];let s=window.getComputedStyle(c);return[parseFloat(s.paddingBlockStart||s.paddingTop),parseFloat(s.paddingBlockEnd||s.paddingBottom)]},[e.optionsRef.current]),r=tt({scrollPaddingStart:t,scrollPaddingEnd:o,count:e.virtual.options.length,estimateSize(){return 40},getScrollElement(){var c;return(c=e.optionsRef.current)!=null?c:null},overscan:12}),[l,u]=p.useState(0);return j(()=>{u(c=>c+1)},[(i=e.virtual)==null?void 0:i.options]),L.createElement(ye.Provider,{value:r},L.createElement("div",{style:{position:"relative",width:"100%",height:`${r.getTotalSize()}px`},ref:c=>{if(c){if(typeof process<"u"&&{}.JEST_WORKER_ID!==void 0||e.activationTrigger===0)return;e.activeOptionIndex!==null&&e.virtual.options.length>e.activeOptionIndex&&r.scrollToIndex(e.activeOptionIndex)}}},r.getVirtualItems().map(c=>{var s;return L.createElement(p.Fragment,{key:c.key},L.cloneElement((s=n.children)==null?void 0:s.call(n,{option:e.virtual.options[c.index],open:e.comboboxState===0}),{key:`${l}-${c.key}`,"data-index":c.index,"aria-setsize":e.virtual.options.length,"aria-posinset":c.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${c.start}px)`,overflowAnchor:"none"}}))})))}let pe=p.createContext(null);pe.displayName="ComboboxDataContext";function V(n){let i=p.useContext(pe);if(i===null){let e=new Error(`<${n} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,V),e}return i}function st(n,i){return J(i.type,at,n,i)}let ct=p.Fragment;function dt(n,i){let{value:e,defaultValue:t,onChange:o,form:r,name:l,by:u=null,disabled:c=!1,__demoMode:s=!1,nullable:f=!1,multiple:m=!1,immediate:R=!1,virtual:a=null,...v}=n,g=!1,O=null,[h=m?[]:void 0,M]=nt(e,o,t),[w,z]=p.useReducer(st,{dataRef:p.createRef(),comboboxState:s?0:1,options:[],virtual:null,activeOptionIndex:null,activationTrigger:2,labelId:null}),P=p.useRef(!1),B=p.useRef({static:!1,hold:!1}),K=p.useRef(null),U=p.useRef(null),Y=p.useRef(null),C=p.useRef(null),S=x(typeof u=="string"?(b,I)=>{let D=u;return(b==null?void 0:b[D])===(I==null?void 0:I[D])}:u??((b,I)=>b===I)),F=x(b=>w.options.findIndex(I=>S(I.dataRef.current.value,b))),re=p.useCallback(b=>J(d.mode,{1:()=>h.some(I=>S(I,b)),0:()=>S(h,b)}),[h]),ie=x(b=>w.activeOptionIndex===F(b)),d=p.useMemo(()=>({...w,immediate:g,optionsPropsRef:B,labelRef:K,inputRef:U,buttonRef:Y,optionsRef:C,value:h,defaultValue:t,disabled:c,mode:m?1:0,virtual:w.virtual,get activeOptionIndex(){if(P.current&&w.activeOptionIndex===null&&w.options.length>0){let b=w.options.findIndex(I=>!I.dataRef.current.disabled);if(b!==-1)return b}return w.activeOptionIndex},calculateIndex:F,compare:S,isSelected:re,isActive:ie,nullable:f,__demoMode:s}),[h,t,c,m,f,s,w,O]);j(()=>{},[O,void 0]),j(()=>{w.dataRef.current=d},[d]),Ae([d.buttonRef,d.inputRef,d.optionsRef],()=>ae.closeCombobox(),d.comboboxState===0);let $=p.useMemo(()=>{var b,I,D;return{open:d.comboboxState===0,disabled:c,activeIndex:d.activeOptionIndex,activeOption:d.activeOptionIndex===null?null:d.virtual?d.virtual.options[(b=d.activeOptionIndex)!=null?b:0]:(D=(I=d.options[d.activeOptionIndex])==null?void 0:I.dataRef.current.value)!=null?D:null,value:h}},[d,c,h]),E=x(()=>{if(d.activeOptionIndex!==null){if(d.virtual)le(d.virtual.options[d.activeOptionIndex]);else{let{dataRef:b}=d.options[d.activeOptionIndex];le(b.current.value)}ae.goToOption(T.Specific,d.activeOptionIndex)}}),_=x(()=>{z({type:0}),P.current=!0}),y=x(()=>{z({type:1}),P.current=!1}),A=x((b,I,D)=>(P.current=!1,b===T.Specific?z({type:2,focus:T.Specific,idx:I,trigger:D}):z({type:2,focus:b,trigger:D}))),N=x((b,I)=>(z({type:3,payload:{id:b,dataRef:I}}),()=>{d.isActive(I.current.value)&&(P.current=!0),z({type:4,id:b})})),Te=x(b=>(z({type:5,id:b}),()=>z({type:5,id:null}))),le=x(b=>J(d.mode,{0(){return M==null?void 0:M(b)},1(){let I=d.value.slice(),D=I.findIndex(ee=>S(ee,b));return D===-1?I.push(b):I.splice(D,1),M==null?void 0:M(I)}})),Ee=x(b=>{z({type:6,trigger:b})}),ae=p.useMemo(()=>({onChange:le,registerOption:N,registerLabel:Te,goToOption:A,closeCombobox:y,openCombobox:_,setActivationTrigger:Ee,selectActiveOption:E}),[]),Me=i===null?{}:{ref:i},Z=p.useRef(null),we=ce();return p.useEffect(()=>{Z.current&&t!==void 0&&we.addEventListener(Z.current,"reset",()=>{M==null||M(t)})},[Z,M]),L.createElement(fe.Provider,{value:ae},L.createElement(pe.Provider,{value:d},L.createElement(ze,{value:J(d.comboboxState,{0:te.Open,1:te.Closed})},l!=null&&h!=null&&Se({[l]:h}).map(([b,I],D)=>L.createElement(Be,{features:Ke.Hidden,ref:D===0?ee=>{var ve;Z.current=(ve=ee==null?void 0:ee.closest("form"))!=null?ve:null}:void 0,...Pe({key:b,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:r,name:b,value:I})})),X({ourProps:Me,theirProps:v,slot:$,defaultTag:ct,name:"Combobox"}))))}let ft="input";function pt(n,i){var e,t,o,r,l;let u=G(),{id:c=`headlessui-combobox-input-${u}`,onChange:s,displayValue:f,type:m="text",...R}=n,a=V("Combobox.Input"),v=Q("Combobox.Input"),g=W(a.inputRef,i),O=ke(a.inputRef),h=p.useRef(!1),M=ce(),w=x(()=>{v.onChange(null),a.optionsRef.current&&(a.optionsRef.current.scrollTop=0),v.goToOption(T.Nothing)}),z=function(){var d;return typeof f=="function"&&a.value!==void 0?(d=f(a.value))!=null?d:"":typeof a.value=="string"?a.value:""}();ge(([d,$],[E,_])=>{if(h.current)return;let y=a.inputRef.current;y&&((_===0&&$===1||d!==E)&&(y.value=d),requestAnimationFrame(()=>{if(h.current||!y||(O==null?void 0:O.activeElement)!==y)return;let{selectionStart:A,selectionEnd:N}=y;Math.abs((N??0)-(A??0))===0&&A===0&&y.setSelectionRange(y.value.length,y.value.length)}))},[z,a.comboboxState,O]),ge(([d],[$])=>{if(d===0&&$===1){if(h.current)return;let E=a.inputRef.current;if(!E)return;let _=E.value,{selectionStart:y,selectionEnd:A,selectionDirection:N}=E;E.value="",E.value=_,N!==null?E.setSelectionRange(y,A,N):E.setSelectionRange(y,A)}},[a.comboboxState]);let P=p.useRef(!1),B=x(()=>{P.current=!0}),K=x(()=>{M.nextFrame(()=>{P.current=!1})}),U=x(d=>{switch(h.current=!0,d.key){case k.Enter:if(h.current=!1,a.comboboxState!==0||P.current)return;if(d.preventDefault(),d.stopPropagation(),a.activeOptionIndex===null){v.closeCombobox();return}v.selectActiveOption(),a.mode===0&&v.closeCombobox();break;case k.ArrowDown:return h.current=!1,d.preventDefault(),d.stopPropagation(),J(a.comboboxState,{0:()=>v.goToOption(T.Next),1:()=>v.openCombobox()});case k.ArrowUp:return h.current=!1,d.preventDefault(),d.stopPropagation(),J(a.comboboxState,{0:()=>v.goToOption(T.Previous),1:()=>{v.openCombobox(),M.nextFrame(()=>{a.value||v.goToOption(T.Last)})}});case k.Home:if(d.shiftKey)break;return h.current=!1,d.preventDefault(),d.stopPropagation(),v.goToOption(T.First);case k.PageUp:return h.current=!1,d.preventDefault(),d.stopPropagation(),v.goToOption(T.First);case k.End:if(d.shiftKey)break;return h.current=!1,d.preventDefault(),d.stopPropagation(),v.goToOption(T.Last);case k.PageDown:return h.current=!1,d.preventDefault(),d.stopPropagation(),v.goToOption(T.Last);case k.Escape:return h.current=!1,a.comboboxState!==0?void 0:(d.preventDefault(),a.optionsRef.current&&!a.optionsPropsRef.current.static&&d.stopPropagation(),a.nullable&&a.mode===0&&a.value===null&&w(),v.closeCombobox());case k.Tab:if(h.current=!1,a.comboboxState!==0)return;a.mode===0&&a.activationTrigger!==1&&v.selectActiveOption(),v.closeCombobox();break}}),Y=x(d=>{s==null||s(d),a.nullable&&a.mode===0&&d.target.value===""&&w(),v.openCombobox()}),C=x(d=>{var $,E,_;let y=($=d.relatedTarget)!=null?$:he.find(A=>A!==d.currentTarget);if(h.current=!1,!((E=a.optionsRef.current)!=null&&E.contains(y))&&!((_=a.buttonRef.current)!=null&&_.contains(y))&&a.comboboxState===0)return d.preventDefault(),a.mode===0&&(a.nullable&&a.value===null?w():a.activationTrigger!==1&&v.selectActiveOption()),v.closeCombobox()}),S=x(d=>{var $,E,_;let y=($=d.relatedTarget)!=null?$:he.find(A=>A!==d.currentTarget);(E=a.buttonRef.current)!=null&&E.contains(y)||(_=a.optionsRef.current)!=null&&_.contains(y)||a.disabled||a.immediate&&a.comboboxState!==0&&(v.openCombobox(),M.nextFrame(()=>{v.setActivationTrigger(1)}))}),F=de(()=>{if(a.labelId)return[a.labelId].join(" ")},[a.labelId]),re=p.useMemo(()=>({open:a.comboboxState===0,disabled:a.disabled}),[a]),ie={ref:g,id:c,role:"combobox",type:m,"aria-controls":(e=a.optionsRef.current)==null?void 0:e.id,"aria-expanded":a.comboboxState===0,"aria-activedescendant":a.activeOptionIndex===null?void 0:a.virtual?(t=a.options.find(d=>{var $;return!(($=a.virtual)!=null&&$.disabled(d.dataRef.current.value))&&a.compare(d.dataRef.current.value,a.virtual.options[a.activeOptionIndex])}))==null?void 0:t.id:(o=a.options[a.activeOptionIndex])==null?void 0:o.id,"aria-labelledby":F,"aria-autocomplete":"list",defaultValue:(l=(r=n.defaultValue)!=null?r:a.defaultValue!==void 0?f==null?void 0:f(a.defaultValue):null)!=null?l:a.defaultValue,disabled:a.disabled,onCompositionStart:B,onCompositionEnd:K,onKeyDown:U,onChange:Y,onFocus:S,onBlur:C};return X({ourProps:ie,theirProps:R,slot:re,defaultTag:ft,name:"Combobox.Input"})}let vt="button";function mt(n,i){var e;let t=V("Combobox.Button"),o=Q("Combobox.Button"),r=W(t.buttonRef,i),l=G(),{id:u=`headlessui-combobox-button-${l}`,...c}=n,s=ce(),f=x(g=>{switch(g.key){case k.ArrowDown:return g.preventDefault(),g.stopPropagation(),t.comboboxState===1&&o.openCombobox(),s.nextFrame(()=>{var O;return(O=t.inputRef.current)==null?void 0:O.focus({preventScroll:!0})});case k.ArrowUp:return g.preventDefault(),g.stopPropagation(),t.comboboxState===1&&(o.openCombobox(),s.nextFrame(()=>{t.value||o.goToOption(T.Last)})),s.nextFrame(()=>{var O;return(O=t.inputRef.current)==null?void 0:O.focus({preventScroll:!0})});case k.Escape:return t.comboboxState!==0?void 0:(g.preventDefault(),t.optionsRef.current&&!t.optionsPropsRef.current.static&&g.stopPropagation(),o.closeCombobox(),s.nextFrame(()=>{var O;return(O=t.inputRef.current)==null?void 0:O.focus({preventScroll:!0})}));default:return}}),m=x(g=>{if(Fe(g.currentTarget))return g.preventDefault();t.comboboxState===0?o.closeCombobox():(g.preventDefault(),o.openCombobox()),s.nextFrame(()=>{var O;return(O=t.inputRef.current)==null?void 0:O.focus({preventScroll:!0})})}),R=de(()=>{if(t.labelId)return[t.labelId,u].join(" ")},[t.labelId,u]),a=p.useMemo(()=>({open:t.comboboxState===0,disabled:t.disabled,value:t.value}),[t]),v={ref:r,id:u,type:Le(n,t.buttonRef),tabIndex:-1,"aria-haspopup":"listbox","aria-controls":(e=t.optionsRef.current)==null?void 0:e.id,"aria-expanded":t.comboboxState===0,"aria-labelledby":R,disabled:t.disabled,onClick:m,onKeyDown:f};return X({ourProps:v,theirProps:c,slot:a,defaultTag:vt,name:"Combobox.Button"})}let bt="label";function gt(n,i){let e=G(),{id:t=`headlessui-combobox-label-${e}`,...o}=n,r=V("Combobox.Label"),l=Q("Combobox.Label"),u=W(r.labelRef,i);j(()=>l.registerLabel(t),[t]);let c=x(()=>{var f;return(f=r.inputRef.current)==null?void 0:f.focus({preventScroll:!0})}),s=p.useMemo(()=>({open:r.comboboxState===0,disabled:r.disabled}),[r]);return X({ourProps:{ref:u,id:t,onClick:c},theirProps:o,slot:s,defaultTag:bt,name:"Combobox.Label"})}let ht="ul",xt=me.RenderStrategy|me.Static;function Ot(n,i){let e=G(),{id:t=`headlessui-combobox-options-${e}`,hold:o=!1,...r}=n,l=V("Combobox.Options"),u=W(l.optionsRef,i),c=De(),s=(()=>c!==null?(c&te.Open)===te.Open:l.comboboxState===0)();j(()=>{var a;l.optionsPropsRef.current.static=(a=n.static)!=null?a:!1},[l.optionsPropsRef,n.static]),j(()=>{l.optionsPropsRef.current.hold=o},[l.optionsPropsRef,o]),Ne({container:l.optionsRef.current,enabled:l.comboboxState===0,accept(a){return a.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:a.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(a){a.setAttribute("role","none")}});let f=de(()=>{var a,v;return(v=l.labelId)!=null?v:(a=l.buttonRef.current)==null?void 0:a.id},[l.labelId,l.buttonRef.current]),m=p.useMemo(()=>({open:l.comboboxState===0,option:void 0}),[l]),R={"aria-labelledby":f,role:"listbox","aria-multiselectable":l.mode===1?!0:void 0,id:t,ref:u};return l.virtual&&l.comboboxState===0&&Object.assign(r,{children:L.createElement(ut,null,r.children)}),X({ourProps:R,theirProps:r,slot:m,defaultTag:ht,features:xt,visible:s,name:"Combobox.Options"})}let It="li";function St(n,i){var e;let t=G(),{id:o=`headlessui-combobox-option-${t}`,disabled:r=!1,value:l,order:u=null,...c}=n,s=V("Combobox.Option"),f=Q("Combobox.Option"),m=s.virtual?s.activeOptionIndex===s.calculateIndex(l):s.activeOptionIndex===null?!1:((e=s.options[s.activeOptionIndex])==null?void 0:e.id)===o,R=s.isSelected(l),a=p.useRef(null),v=Oe({disabled:r,value:l,domRef:a,order:u}),g=p.useContext(ye),O=W(i,a,g?g.measureElement:null),h=x(()=>f.onChange(l));j(()=>f.registerOption(o,v),[v,o]);let M=p.useRef(!(s.virtual||s.__demoMode));j(()=>{if(!s.virtual||!s.__demoMode)return;let C=xe();return C.requestAnimationFrame(()=>{M.current=!0}),C.dispose},[s.virtual,s.__demoMode]),j(()=>{if(!M.current||s.comboboxState!==0||!m||s.activationTrigger===0)return;let C=xe();return C.requestAnimationFrame(()=>{var S,F;(F=(S=a.current)==null?void 0:S.scrollIntoView)==null||F.call(S,{block:"nearest"})}),C.dispose},[a,m,s.comboboxState,s.activationTrigger,s.activeOptionIndex]);let w=x(C=>{var S;if(r||(S=s.virtual)!=null&&S.disabled(l))return C.preventDefault();h(),_e()||requestAnimationFrame(()=>{var F;return(F=s.inputRef.current)==null?void 0:F.focus({preventScroll:!0})}),s.mode===0&&requestAnimationFrame(()=>f.closeCombobox())}),z=x(()=>{var C;if(r||(C=s.virtual)!=null&&C.disabled(l))return f.goToOption(T.Nothing);let S=s.calculateIndex(l);f.goToOption(T.Specific,S)}),P=Ve(),B=x(C=>P.update(C)),K=x(C=>{var S;if(!P.wasMoved(C)||r||(S=s.virtual)!=null&&S.disabled(l)||m)return;let F=s.calculateIndex(l);f.goToOption(T.Specific,F,0)}),U=x(C=>{var S;P.wasMoved(C)&&(r||(S=s.virtual)!=null&&S.disabled(l)||m&&(s.optionsPropsRef.current.hold||f.goToOption(T.Nothing)))}),Y=p.useMemo(()=>({active:m,selected:R,disabled:r}),[m,R,r]);return X({ourProps:{id:o,ref:O,role:"option",tabIndex:r===!0?void 0:-1,"aria-disabled":r===!0?!0:void 0,"aria-selected":R,disabled:void 0,onClick:w,onFocus:z,onPointerEnter:B,onMouseEnter:B,onPointerMove:K,onMouseMove:K,onPointerLeave:U,onMouseLeave:U},theirProps:c,slot:Y,defaultTag:It,name:"Combobox.Option"})}let Rt=H(dt),Ct=H(mt),yt=H(pt),Tt=H(gt),Et=H(Ot),Mt=H(St),Lt=Object.assign(Rt,{Input:yt,Button:Ct,Label:Tt,Options:Et,Option:Mt});export{Lt as q};
